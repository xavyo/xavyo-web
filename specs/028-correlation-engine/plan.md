# Implementation Plan: Identity Correlation Engine

**Branch**: `028-correlation-engine` | **Date**: 2026-02-12 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/028-correlation-engine/spec.md`

## Summary

Add a complete frontend for the xavyo-idp correlation engine enabling admins to configure attribute matching rules and confidence thresholds per connector, trigger batch correlation jobs, review uncertain matches in a case management queue, manage tenant-wide identity correlation rules, and monitor correlation performance through statistics and audit trails. The UI splits between connector-scoped configuration (rules, thresholds, jobs, stats as tabs on connector detail) and global features (cases, identity rules, audit as a governance correlation hub).

## Technical Context

**Language/Version**: TypeScript 5.x / Svelte 5 (runes mode) + SvelteKit
**Primary Dependencies**: Bits UI, Tailwind CSS v4, Superforms + Zod (via `zod/v3`), lucide-svelte
**Storage**: N/A (all data via xavyo-idp REST API through BFF proxy)
**Testing**: Vitest + @testing-library/svelte (unit), Chrome DevTools MCP (E2E)
**Target Platform**: Web browser (desktop primary)
**Project Type**: Web application (SvelteKit frontend only)
**Performance Goals**: Stats/audit load < 2s, job status polling at 5s intervals
**Constraints**: Admin role required for all mutations (Constitution Principle I: BFF Security)
**Scale/Scope**: ~18 BFF proxy endpoints, ~10 components, 2 page routes (connector detail modification + correlation hub), ~48 API client functions

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. BFF Security | PASS | All API calls through SvelteKit server, tokens in HttpOnly cookies, BFF proxies validate session |
| II. Test-Driven Development | PASS | Unit tests for all schemas, API clients, components, pages |
| III. Honest Reviews | PASS | Post-implementation review + E2E via Chrome DevTools MCP planned |
| IV. Svelte 5 Runes Only | PASS | All components use $state, $derived, $props, $effect |
| V. Minimal Complexity | PASS | No abstractions beyond what's needed, reuse existing DataTable/EmptyState/Badge components |
| VI. Type Safety | PASS | All API types in types.ts mirror backend DTOs, Zod schemas match TS types |
| VII. English Only | PASS | All UI text in English |
| VIII. Backend Fidelity | PASS | All endpoints verified in backend deep-dive (see research.md); no phonetic match type (removed); no job cancel (removed) |

**Post-Phase 1 Re-check**: All gates still pass. No new violations introduced by design decisions.

## Project Structure

### Documentation (this feature)

```text
specs/028-correlation-engine/
├── plan.md
├── spec.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   └── api-routes.md
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/
├── lib/
│   ├── api/
│   │   ├── correlation.ts              # Server-side API client
│   │   ├── correlation-client.ts       # Client-side API client
│   │   └── types.ts                    # Add correlation types (modify)
│   ├── schemas/
│   │   └── correlation.ts              # Zod validation schemas
│   └── components/
│       └── correlation/                # Feature components
│           ├── rules-table.svelte
│           ├── rule-form.svelte
│           ├── threshold-form.svelte
│           ├── job-status.svelte
│           ├── statistics-cards.svelte
│           ├── trends-table.svelte
│           ├── case-detail.svelte
│           ├── candidate-card.svelte
│           ├── identity-rules-table.svelte
│           └── audit-table.svelte
├── routes/
│   ├── api/
│   │   ├── connectors/[connectorId]/correlation/  # Connector-scoped BFF proxies
│   │   │   ├── rules/+server.ts
│   │   │   ├── rules/[id]/+server.ts
│   │   │   ├── rules/validate-expression/+server.ts
│   │   │   ├── thresholds/+server.ts
│   │   │   ├── evaluate/+server.ts
│   │   │   ├── jobs/[jobId]/+server.ts
│   │   │   ├── statistics/+server.ts
│   │   │   └── statistics/trends/+server.ts
│   │   └── governance/correlation/                 # Global BFF proxies
│   │       ├── cases/+server.ts
│   │       ├── cases/[caseId]/+server.ts
│   │       ├── cases/[caseId]/confirm/+server.ts
│   │       ├── cases/[caseId]/reject/+server.ts
│   │       ├── cases/[caseId]/create-identity/+server.ts
│   │       ├── cases/[caseId]/reassign/+server.ts
│   │       ├── identity-rules/+server.ts
│   │       ├── identity-rules/[id]/+server.ts
│   │       ├── audit/+server.ts
│   │       └── audit/[eventId]/+server.ts
│   └── (app)/
│       ├── connectors/[id]/            # Modify existing — add correlation tabs
│       │   ├── +page.server.ts
│       │   └── +page.svelte
│       ├── governance/correlation/     # New — correlation hub
│       │   ├── +page.server.ts
│       │   └── +page.svelte
│       └── governance/correlation/cases/[caseId]/  # New — case detail
│           ├── +page.server.ts
│           └── +page.svelte
```

**Structure Decision**: Follows established project patterns. Connector-scoped features integrate into the existing connector detail page via additional tabs. Global features (cases, identity rules, audit) get a new governance sub-section at `/governance/correlation/`.

## Complexity Tracking

No constitution violations to justify. All design decisions follow established patterns.
